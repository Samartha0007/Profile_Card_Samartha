<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Profile</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        input, button {
            display: block;
            margin: 10px auto;
            padding: 10px;
            width: 80%;
            max-width: 300px;
        }
        #profileMessage {
            margin-top: 10px;
            font-weight: bold;
            color: green;
        }
    </style>
</head>
<body>

    <h2>Create Your Profile</h2>
    <input type="text" id="name" placeholder="Enter your name" required>
    <input type="text" id="bio" placeholder="Enter your bio" required>
    <input type="file" id="profilePic" accept="image/*">
    <button id="createProfileBtn">Create Profile</button>
    <div id="profileMessage"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCm-xpBYqXjygAoJxCoElqDxC3yiC7Rty8",
            authDomain: "samarthags-cloud.firebaseapp.com",
            projectId: "samarthags-cloud",
            storageBucket: "samarthags-cloud.appspot.com",
            messagingSenderId: "468966383448",
            appId: "1:468966383448:web:cf80f5cc91efc6acb3d44a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        document.getElementById("createProfileBtn").addEventListener("click", async () => {
            const name = document.getElementById("name").value.trim();
            const bio = document.getElementById("bio").value.trim();
            const profilePic = document.getElementById("profilePic").files[0];
            const messageDiv = document.getElementById("profileMessage");

            if (!name || !bio || !profilePic) {
                messageDiv.innerHTML = "⚠️ Please fill all fields and upload a profile picture!";
                return;
            }

            messageDiv.innerHTML = "⏳ Creating profile...";

            try {
                // Upload profile picture
                const storageRef = storage.ref(`profile_pics/${Date.now()}_${profilePic.name}`);
                const uploadTask = await storageRef.put(profilePic);
                const profilePicURL = await uploadTask.ref.getDownloadURL();

                // Store profile in Firestore
                const profileRef = await db.collection("profiles").add({
                    name, bio, profilePicURL
                });

                const profileURL = `https://samarthags.cloud/profile/${profileRef.id}`;

                messageDiv.innerHTML = `
                    ✅ Profile created successfully!<br>
                    <a href="${profileURL}" target="_blank">${profileURL}</a>
                `;
            } catch (error) {
                console.error("Error creating profile:", error);
                messageDiv.innerHTML = "❌ Error creating profile. Please try again.";
            }
        });
    </script>

</body>
</html>