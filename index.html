<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--=============== FAVICON ===============-->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="assets/favicons/site.webmanifest">
    <link rel="mask-icon" href="assets/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="assets/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#a789d4">

    <!--=============== BOXICONS ===============-->
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>

    <!--=============== CSS ===============-->
    <link rel="stylesheet" href="/styles.css">

    <title id="page-title">MyPortfolio</title>
</head>

<body class="dark-theme">
    <!--=============== LOADING ===============-->
    <div class="loading" id="loading">
        <i class='bx bx-loader-alt bx-spin'></i> Loading...
    </div>

    <!--=============== PROFILE NOT FOUND ===============-->
    <div class="not-found" id="not-found" style="display:none;">
        <h2>Profile Not Found</h2>
        <p>The profile you're looking for doesn't exist.</p>
        <a href="/" class="back-home">Go to Home</a>
    </div>

    <!--=============== INTRO PAGE ===============-->
    <div class="intro-container" id="intro-container" style="display:none;">
        <div class="intro-content">
            <h1>MyPortfolio</h1>
            <p>Create and share your personalized profile page with all your social links in one place</p>

            <div class="intro-features">
                <div class="feature">
                    <i class='bx bxs-user-circle'></i>
                    <h3>Personal Profile</h3>
                    <p>Showcase your information and bio</p>
                </div>
                <div class="feature">
                    <i class='bx bxs-heart'></i>
                    <h3>Show Some Love</h3>
                    <p>Anyone visiting your profile can 'like' to show they appreciate you.</p>
                </div>
                <div class="feature">
                    <i class='bx bxs-share-alt'></i>
                    <h3>Social Links</h3>
                    <p>All your social media in one place</p>
                </div>
                <div class="feature">
                    <i class='bx bxs-video'></i>
                    <h3>Content Creator</h3>
                    <p>Perfect for YouTubers, gamers and creators</p>
                </div>
            </div>

            <a href="/create" class="cta-button">Create Your Profile</a>
        </div>

        <footer class="main-footer">
            Made with ðŸ–¤ By 
            <b><a href="https://samarthags.in" target="_blank">Samartha GS</a></b>
        </footer>
    </div>

    <!--=============== HEADER ===============-->
    <header class="header" id="header" style="display:none;">
        <nav class="nav container">
            <a href="#" class="nav__logo" id="nav-logo">Profile</a>
            <i class='bx bx-sun change-theme' id="theme-button"></i>
        </nav>
    </header>

    <!--=============== MAIN ===============-->
    <main class="main" id="main" style="display:none;">
        <!--=============== HOME ===============-->
        <section class="home section" id="home">
            <div class="home__container container grid">
                <div class="home__data">
                    <span class="home__greeting">Hello, I'm</span>
                    <h1 class="home__name" id="profile-name">Loading...</h1>
                    <h3 class="home__education" id="profile-bio">Loading...</h3>

                    <div class="home__buttons">
                        <button id="likeButton" class="button button--ghost">
                            <i class='bx bxs-like'></i> <span id="likeCount">0</span>
                        </button>
                    </div>
                </div>

                <div class="home__social" id="social-links">
                    <!-- Social links will be dynamically populated -->
                </div>

                <a href="#about" class="home__scroll">
                    <i class='bx bx-mouse home__scroll-icon'></i>
                    <span class="home__scroll-name">Scroll Down</span>
                </a>
            </div>
        </section>

        <!--=============== ABOUT ===============-->
        <section class="about section" id="about">
            <span class="section__subtitle">My Intro</span>
            <h2 class="section__title">About Me</h2>

            <div class="about__container container grid">
                <img src="" alt="" class="about__img" id="profile-image">

                <div class="about__data">
                    <div class="about__info">
                        <div class="about__box">
                            <i class='bx bxs-map about__icon'></i>
                            <h3 class="about__title" id="location-display">Location</h3>
                            <span class="about__subtitle">Location</span>
                        </div>

                        <div class="about__box">
                            <i class='bx bxs-cake about__icon'></i>
                            <h3 class="about__title" id="birthday-display">Birthday</h3>
                            <span class="about__subtitle">Birthday</span>
                        </div>

                        <div class="about__box">
                            <i class='bx bxs-show about__icon'></i>
                            <h3 class="about__title" id="views-count">0</h3>
                            <span class="about__subtitle">Views</span>
                        </div>
                    </div>

                    <p class="about__description" id="full-bio">
                        Loading profile information...
                    </p>

                    <a href="#" target="_blank" class="button about__button-contact" id="main-cta">
                        Subscribe <i class='bx bxl-youtube'></i>
                    </a>
                </div>
            </div>
        </section>

        <!--=============== CONTACT ===============-->
        <section class="contact section" id="contact">
            <span class="section__subtitle">Get in touch</span>
            <h2 class="section__title">Connect with me</h2>

            <div class="contact__container container grid">
                <div class="contact__content">
                    <div class="contact__info" id="contact-cards">
                        <!-- Contact cards will be dynamically populated -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!--=============== FOOTER ===============-->
    <footer class="footer" id="footer" style="display:none;">
        <div class="footer__container container">
            <ul class="footer__social" id="footer-social">
                <!-- Footer social links will be dynamically populated -->
            </ul>
            <div class="developer-credit">
                Designed and developed by <a href="https://samarthags.in" target="_blank">Samartha GS</a>
            </div>
        </div>
    </footer>

    <!--=============== SCROLLREVEAL ===============-->
    <script src="https://unpkg.com/scrollreveal"></script>

    <!--=============== FIREBASE & MAIN JS ===============-->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where, doc, updateDoc, getDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBb3x_zD9JaFwL9PhmngCNZlS2fOh6MBa4",
            authDomain: "newai-52371.firebaseapp.com",
            projectId: "newai-52371",
            storageBucket: "newai-52371.appspot.com",
            messagingSenderId: "480586908639",
            appId: "1:480586908639:web:f4645a852c4df724c6fa6a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global variables
        let currentProfileId = null;
        let currentUsername = null;
        let hasLiked = false;

        // Format numbers with commas
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Get username from URL path
        function getUsernameFromPath() {
            const path = window.location.pathname.substring(1);
            return path ? decodeURIComponent(path).toLowerCase() : null;
        }

        // Update page SEO and meta tags
        function updatePageMeta(profile) {
            document.title = `${profile.name} | MyPortfolio`;
            document.getElementById('page-title').textContent = `${profile.name} | MyPortfolio`;
            
            // Update meta description
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) {
                metaDesc.setAttribute('content', profile.bio || `Check out ${profile.name}'s profile`);
            }
        }

        // Load profile data
        async function loadProfile() {
            const username = getUsernameFromPath();
            currentUsername = username;

            if (!username) {
                // Show intro page
                document.getElementById('loading').style.display = 'none';
                document.getElementById('intro-container').style.display = 'block';
                return;
            }

            try {
                // Query for profile by username
                const q = query(collection(db, "profiles"), where("username", "==", username));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const profileDoc = querySnapshot.docs[0];
                    const profile = profileDoc.data();
                    currentProfileId = profileDoc.id;

                    // Update page meta
                    updatePageMeta(profile);

                    // Show main content
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('header').style.display = 'block';
                    document.getElementById('main').style.display = 'block';
                    document.getElementById('footer').style.display = 'block';

                    // Populate profile data
                    populateProfile(profile);

                    // Initialize like system
                    await initializeLikeSystem();

                    // Initialize scroll reveal
                    initializeScrollReveal();

                } else {
                    // Profile not found
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('not-found').style.display = 'block';
                }
            } catch (error) {
                console.error("Error loading profile:", error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('not-found').style.display = 'block';
            }
        }

        // Populate profile data
        function populateProfile(profile) {
            // Basic info
            document.getElementById('profile-name').textContent = profile.name || 'Name';
            document.getElementById('profile-bio').textContent = profile.bio || 'Content Creator';
            document.getElementById('full-bio').textContent = profile.fullBio || profile.bio || 'No bio available.';
            document.getElementById('nav-logo').textContent = profile.name || 'Profile';

            // Profile image
            const profileImg = document.getElementById('profile-image');
            profileImg.src = profile.imageUrl || 'https://via.placeholder.com/300x300?text=No+Image';
            profileImg.alt = profile.name || 'Profile Image';

            // Stats
            document.getElementById('location-display').textContent = profile.location || 'Not specified';
            
            // Format birthday
            if (profile.birthday) {
                const birthday = new Date(profile.birthday);
                const formattedBirthday = birthday.toLocaleDateString('en-US', { 
                    month: 'long', 
                    day: 'numeric',
                    year: 'numeric'
                });
                document.getElementById('birthday-display').textContent = formattedBirthday;
            } else {
                document.getElementById('birthday-display').textContent = 'Not specified';
            }
            
            document.getElementById('views-count').textContent = formatNumber(profile.views || 0);

            // Main CTA
            const mainCta = document.getElementById('main-cta');
            if (profile.youtubeChannel) {
                mainCta.href = `https://www.youtube.com/${profile.youtubeChannel}?sub_confirmation=1`;
                mainCta.innerHTML = 'Subscribe on YouTube <i class="bx bxl-youtube"></i>';
            } else {
                mainCta.style.display = 'none';
            }

            // Social links
            populateSocialLinks(profile);
            populateContactCards(profile);
        }

        // Populate social links
        function populateSocialLinks(profile) {
            const socialContainer = document.getElementById('social-links');
            const footerSocial = document.getElementById('footer-social');
            
            let socialHTML = '';
            let footerSocialHTML = '';

            const socialPlatforms = {
                instagram: { url: `https://www.instagram.com/${profile.instagram}`, icon: 'bxl-instagram' },
                snapchat: { url: `https://www.snapchat.com/add/${profile.snapchat}`, icon: 'bxl-snapchat' },
                youtube: { url: `https://www.youtube.com/${profile.youtubeChannel}`, icon: 'bxl-youtube' },
                twitter: { url: `https://twitter.com/${profile.twitter}`, icon: 'bxl-twitter' },
                facebook: { url: `https://facebook.com/${profile.facebook}`, icon: 'bxl-facebook' },
                linkedin: { url: `https://linkedin.com/in/${profile.linkedin}`, icon: 'bxl-linkedin' },
                github: { url: `https://github.com/${profile.github}`, icon: 'bxl-github' },
                telegram: { url: `https://t.me/${profile.telegram}`, icon: 'bxl-telegram' },
                whatsapp: { url: `https://wa.me/${profile.whatsapp}`, icon: 'bxl-whatsapp' }
            };

            Object.entries(socialPlatforms).forEach(([platform, config]) => {
                if (profile[platform]) {
                    socialHTML += `<a href="${config.url}" target="_blank" class="home__social-link"><i class='bx ${config.icon}'></i></a>`;
                    footerSocialHTML += `<a href="${config.url}" class="footer__social-link"><i class='bx ${config.icon}'></i></a>`;
                }
            });

            socialContainer.innerHTML = socialHTML;
            footerSocial.innerHTML = footerSocialHTML;
        }

        // Populate contact cards
        function populateContactCards(profile) {
            const contactContainer = document.getElementById('contact-cards');
            let contactHTML = '';

            // Instagram
            if (profile.instagram) {
                contactHTML += `
                    <div class="contact__card">
                        <i class='bx bxl-instagram contact__card-icon'></i>
                        <h3 class="contact__card-title">Instagram</h3>
                        <span class="contact__card-data">@${profile.instagram}</span>
                        <a href="https://www.instagram.com/${profile.instagram}" target="_blank" class="contact__button">
                            Follow <i class='bx bx-right-arrow-alt'></i>
                        </a>
                    </div>
                `;
            }

            // Snapchat
            if (profile.snapchat) {
                contactHTML += `
                    <div class="contact__card">
                        <i class='bx bxl-snapchat contact__card-icon'></i>
                        <h3 class="contact__card-title">Snapchat</h3>
                        <span class="contact__card-data">@${profile.snapchat}</span>
                        <a href="https://www.snapchat.com/add/${profile.snapchat}" target="_blank" class="contact__button">
                            Add Me <i class='bx bx-right-arrow-alt'></i>
                        </a>
                    </div>
                `;
            }

            // Email
            if (profile.email) {
                contactHTML += `
                    <div class="contact__card contact__card-email">
                        <i class='bx bxs-envelope contact__card-icon'></i>
                        <h3 class="contact__card-title">Email</h3>
                        <span class="contact__card-data">${profile.email}</span>
                        <a href="mailto:${profile.email}" class="contact__button">
                            Email Me <i class='bx bx-right-arrow-alt'></i>
                        </a>
                    </div>
                `;
            }

            contactContainer.innerHTML = contactHTML;
        }

        // Initialize like system
        async function initializeLikeSystem() {
            if (!currentProfileId) return;

            const likeButton = document.getElementById('likeButton');
            const likeCount = document.getElementById('likeCount');

            // Check if likes document exists, create if not
            const likesRef = doc(db, "profileLikes", currentProfileId);
            let likesDoc = await getDoc(likesRef);

            if (!likesDoc.exists()) {
                await setDoc(likesRef, {
                    count: 0,
                    profileId: currentProfileId,
                    username: currentUsername
                });
                likesDoc = await getDoc(likesRef);
            }

            // Update like count display
            const likesData = likesDoc.data();
            likeCount.textContent = formatNumber(likesData.count || 0);

            // Check if user has already liked
            const userLikeKey = `liked_${currentUsername}_${currentProfileId}`;
            hasLiked = localStorage.getItem(userLikeKey) === 'true';

            if (hasLiked) {
                likeButton.classList.add('button--liked');
            }

            // Add click event listener
            likeButton.addEventListener('click', async () => {
                if (hasLiked) {
                    // Already liked, show message
                    likeButton.classList.add('shake');
                    setTimeout(() => likeButton.classList.remove('shake'), 500);
                    
                    // Create floating message
                    const message = document.createElement('div');
                    message.classList.add('floating-heart');
                    message.innerHTML = 'Already liked! â¤ï¸';
                    message.style.position = 'absolute';
                    message.style.left = likeButton.offsetLeft + 'px';
                    message.style.top = likeButton.offsetTop - 20 + 'px';
                    document.body.appendChild(message);
                    
                    setTimeout(() => message.remove(), 1500);
                    return;
                }

                // Mark as liked
                hasLiked = true;
                localStorage.setItem(userLikeKey, 'true');
                likeButton.classList.add('button--liked');

                // Create floating heart animation
                const heart = document.createElement('div');
                heart.classList.add('floating-heart');
                heart.innerHTML = '+1 â¤ï¸â€ðŸ”¥';
                heart.style.position = 'absolute';
                heart.style.left = likeButton.offsetLeft + likeButton.offsetWidth/2 + 'px';
                heart.style.top = likeButton.offsetTop + 'px';
                document.body.appendChild(heart);

                setTimeout(() => heart.remove(), 1500);

                // Create ripple effect
                const ripple = document.createElement('span');
                ripple.classList.add('ripple');
                ripple.style.left = likeButton.offsetWidth/2 + 'px';
                ripple.style.top = likeButton.offsetHeight/2 + 'px';
                likeButton.appendChild(ripple);

                setTimeout(() => ripple.remove(), 600);

                // Update Firebase
                try {
                    await updateDoc(likesRef, {
                        count: increment(1)
                    });

                    // Get updated count
                    const updatedDoc = await getDoc(likesRef);
                    if (updatedDoc.exists()) {
                        likeCount.textContent = formatNumber(updatedDoc.data().count || 0);
                    }
                } catch (error) {
                    console.error("Error updating likes:", error);
                }
            });
        }

        // Initialize scroll reveal animations
        function initializeScrollReveal() {
            const sr = ScrollReveal({
                origin: 'top',
                distance: '60px',
                duration: 2500,
                delay: 400,
            });

            sr.reveal('.home__data');
            sr.reveal('.home__social, .home__scroll', {delay: 600, origin: 'bottom'});
            sr.reveal('.section__subtitle, .section__title', {origin: 'left'});
            sr.reveal('.about__img', {origin: 'right'});
            sr.reveal('.about__info', {delay: 500});
            sr.reveal('.about__description, .about__button-contact', {delay: 600});
            sr.reveal('.contact__content', {interval: 100});
        }

        // Theme toggle functionality
        function initializeTheme() {
            const themeButton = document.getElementById('theme-button');

            // Set dark theme as default
            document.body.classList.add('dark-theme');
            themeButton.classList.add('bx-sun');

            // Check for saved theme preference
            const savedTheme = localStorage.getItem('selected-theme');
            if (savedTheme === 'light') {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
                themeButton.classList.remove('bx-sun');
                themeButton.classList.add('bx-moon');
            }

            // Theme toggle functionality
            themeButton.addEventListener('click', () => {
                if (document.body.classList.contains('dark-theme')) {
                    document.body.classList.remove('dark-theme');
                    document.body.classList.add('light-theme');
                    themeButton.classList.remove('bx-sun');
                    themeButton.classList.add('bx-moon');
                    localStorage.setItem('selected-theme', 'light');
                } else {
                    document.body.classList.remove('light-theme');
                    document.body.classList.add('dark-theme');
                    themeButton.classList.remove('bx-moon');
                    themeButton.classList.add('bx-sun');
                    localStorage.setItem('selected-theme', 'dark');
                }
            });
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            loadProfile();
        });

    </script>
</body>
</html>